Array.indexOf||(Array.prototype.indexOf=function(n,t){for(var i=t||0;i<this.length;i++)if(this[i]===n)return i;return-1});var Parser=function(n){function f(n){function t(){}return t.prototype=n,new t}function i(n,i,r,u){this.type_=n;this.index_=i||0;this.prio_=r||0;this.number_=u!==undefined&&u!==null?u:0;this.toString=function(){switch(this.type_){case t:return this.number_;case c:case o:case s:return this.index_;case w:return"CALL";default:return"Invalid Token"}}}function l(n,t,i,r){this.tokens=n;this.ops1=t;this.ops2=i;this.functions=r}function rt(n){return typeof n=="string"?(b.lastIndex=0,b.test(n)?"'"+n.replace(b,function(n){var t=it[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+n+"'"):n}function ut(n,t){return Number(n)+Number(t)}function ft(n,t){return n-t}function et(n,t){return n*t}function ot(n,t){return n/t}function st(n,t){return n%t}function ht(n,t){return""+n+t}function ct(n){return-n}function d(n){return Math.random()*(n||1)}function g(n){n=Math.floor(n);for(var t=n;n>1;)t=t*--n;return t}function nt(n,t){return Math.sqrt(n*n+t*t)}function lt(n,t){return Object.prototype.toString.call(n)!="[object Array]"?[n,t]:(n=n.slice(),n.push(t),n)}function r(){this.success=!1;this.errormsg="";this.expression="";this.pos=0;this.tokennumber=0;this.tokenprio=0;this.tokenindex=0;this.tmpprio=0;this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":ct,exp:Math.exp};this.ops2={"+":ut,"-":ft,"*":et,"/":ot,"%":st,"^":Math.pow,",":lt,"||":ht};this.functions={random:d,fac:g,min:Math.min,max:Math.max,pyt:nt,pow:Math.pow,atan2:Math.atan2};this.consts={E:Math.E,PI:Math.PI}}var t=0,c=1,o=2,s=3,w=4,b=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,it={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};l.prototype={simplify:function(n){var e;n=n||{};for(var u=[],h=[],a,p,v,w=this.tokens.length,r,y=0,y=0;y<w;y++)if(r=this.tokens[y],e=r.type_,e===t)u.push(r);else if(e===s&&r.index_ in n)r=new i(t,0,0,n[r.index_]),u.push(r);else if(e===o&&u.length>1)p=u.pop(),a=u.pop(),v=this.ops2[r.index_],r=new i(t,0,0,v(a.number_,p.number_)),u.push(r);else if(e===c&&u.length>0)a=u.pop(),v=this.ops1[r.index_],r=new i(t,0,0,v(a.number_)),u.push(r);else{while(u.length>0)h.push(u.shift());h.push(r)}while(u.length>0)h.push(u.shift());return new l(h,f(this.ops1),f(this.ops2),f(this.functions))},substitute:function(n,t){var a,h,u,v;t instanceof l||(t=(new r).parse(String(t)));for(var c=[],y=this.tokens.length,e,o=0,o=0;o<y;o++)if(e=this.tokens[o],a=e.type_,a===s&&e.index_===n)for(h=0;h<t.tokens.length;h++)u=t.tokens[h],v=new i(u.type_,u.index_,u.prio_,u.number_),c.push(v);else c.push(e);return new l(c,f(this.ops1),f(this.ops2),f(this.functions))},evaluate:function(n){var e;n=n||{};for(var i=[],f,l,r,a=this.tokens.length,u,h=0,h=0;h<a;h++)if(u=this.tokens[h],e=u.type_,e===t)i.push(u.number_);else if(e===o)l=i.pop(),f=i.pop(),r=this.ops2[u.index_],i.push(r(f,l));else if(e===s)if(u.index_ in n)i.push(n[u.index_]);else if(u.index_ in this.functions)i.push(this.functions[u.index_]);else throw new Error("undefined variable: "+u.index_);else if(e===c)f=i.pop(),r=this.ops1[u.index_],i.push(r(f));else if(e===w)if(f=i.pop(),r=i.pop(),r.apply&&r.call)Object.prototype.toString.call(f)=="[object Array]"?i.push(r.apply(undefined,f)):i.push(r.call(undefined,f));else throw new Error(r+" is not a function");else throw new Error("invalid Expression");if(i.length>1)throw new Error("invalid Expression (parity)");return i[0]},toString:function(n){for(var i=[],u,l,r,a=this.tokens.length,f,h=0,e,h=0;h<a;h++)if(f=this.tokens[h],e=f.type_,e===t)i.push(rt(f.number_));else if(e===o)l=i.pop(),u=i.pop(),r=f.index_,n&&r=="^"?i.push("Math.pow("+u+","+l+")"):i.push("("+u+r+l+")");else if(e===s)i.push(f.index_);else if(e===c)u=i.pop(),r=f.index_,r==="-"?i.push("("+r+u+")"):i.push(r+"("+u+")");else if(e===w)u=i.pop(),r=i.pop(),i.push(r+"("+u+")");else throw new Error("invalid Expression");if(i.length>1)throw new Error("invalid Expression (parity)");return i[0]},variables:function(){for(var n,r=this.tokens.length,t=[],i=0;i<r;i++)n=this.tokens[i],n.type_===s&&t.indexOf(n.index_)==-1&&t.push(n.index_);return t},toJSFunction:function(n,t){return new Function(n,"with(Parser.values) { return "+this.simplify(t).toString(!0)+"; }")}};r.parse=function(n){return(new r).parse(n)};r.evaluate=function(n,t){return r.parse(n).evaluate(t)};r.Expression=l;r.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:d,fac:g,exp:Math.exp,min:Math.min,max:Math.max,pyt:nt,pow:Math.pow,atan2:Math.atan2,E:Math.E,PI:Math.PI};var e=1,a=2,h=4,u=8,v=16,y=32,p=64,k=128,tt=256;return r.prototype={parse:function(n){var d,b,r,g,nt,it,rt,ut;for(this.errormsg="",this.success=!0,d=[],b=[],this.tmpprio=0,r=e|u|h|p,g=0,this.expression=n,this.pos=0;this.pos<this.expression.length;)this.isOperator()?this.isSign()&&r&p?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",g++,this.addfunc(b,d,c)),r=e|u|h|p):this.isComment()||((r&a)==0&&this.error_parsing(this.pos,"unexpected operator"),g+=2,this.addfunc(b,d,o),r=e|u|h|p):this.isNumber()?((r&e)==0&&this.error_parsing(this.pos,"unexpected number"),nt=new i(t,0,0,this.tokennumber),b.push(nt),r=a|v|y):this.isString()?((r&e)==0&&this.error_parsing(this.pos,"unexpected string"),nt=new i(t,0,0,this.tokennumber),b.push(nt),r=a|v|y):this.isLeftParenth()?((r&u)==0&&this.error_parsing(this.pos,'unexpected "("'),r&k&&(g+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(b,d,w)),r=e|u|h|p|tt):this.isRightParenth()?(r&tt?(nt=new i(t,0,0,[]),b.push(nt)):(r&v)==0&&this.error_parsing(this.pos,'unexpected ")"'),r=a|v|y|u|k):this.isComma()?((r&y)==0&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(b,d,o),g+=2,r=e|u|h|p):this.isConst()?((r&e)==0&&this.error_parsing(this.pos,"unexpected constant"),it=new i(t,0,0,this.tokennumber),b.push(it),r=a|v|y):this.isOp2()?((r&h)==0&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(b,d,o),g+=2,r=u):this.isOp1()?((r&h)==0&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(b,d,c),g++,r=u):this.isVar()?((r&e)==0&&this.error_parsing(this.pos,"unexpected variable"),rt=new i(s,this.tokenindex,0,0),b.push(rt),r=a|v|y|u|k):this.isWhite()||(this.errormsg===""?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg));for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');d.length>0;)ut=d.pop(),b.push(ut);return g+1!==b.length&&this.error_parsing(this.pos,"parity"),new l(b,f(this.ops1),f(this.ops2),f(this.functions))},evaluate:function(n,t){return this.parse(n).evaluate(t)},error_parsing:function(n,t){this.success=!1;this.errormsg="parse error [column "+n+"]: "+t;throw new Error(this.errormsg);},addfunc:function(n,t,r){for(var u=new i(r,this.tokenindex,this.tokenprio+this.tmpprio,0);t.length>0;)if(u.prio_<=t[t.length-1].prio_)n.push(t.pop());else break;t.push(u)},isNumber:function(){for(var t=!1,i="",n;this.pos<this.expression.length;)if(n=this.expression.charCodeAt(this.pos),n>=48&&n<=57||n===46)i+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(i),t=!0;else break;return t},unescape:function(n,t){for(var u,e,i=[],f=!1,r=0;r<n.length;r++)if(u=n.charAt(r),f){switch(u){case"'":i.push("'");break;case"\\":i.push("\\");break;case"/":i.push("/");break;case"b":i.push("\b");break;case"f":i.push("\f");break;case"n":i.push("\n");break;case"r":i.push("\r");break;case"t":i.push("\t");break;case"u":e=parseInt(n.substring(r+1,r+5),16);i.push(String.fromCharCode(e));r+=4;break;default:throw this.error_parsing(t+r,"Illegal escape sequence: '\\"+u+"'");}f=!1}else u=="\\"?f=!0:i.push(u);return i.join("")},isString:function(){var t=!1,n="",r=this.pos,i;if(this.pos<this.expression.length&&this.expression.charAt(this.pos)=="'")for(this.pos++;this.pos<this.expression.length;)if(i=this.expression.charAt(this.pos),i!="'"||n.slice(-1)=="\\")n+=this.expression.charAt(this.pos),this.pos++;else{this.pos++;this.tokennumber=this.unescape(n,r);t=!0;break}return t},isConst:function(){var i,n,t;for(n in this.consts)if(!0&&(t=n.length,i=this.expression.substr(this.pos,t),n===i))return this.tokennumber=this.consts[n],this.pos+=t,!0;return!1},isOperator:function(){var n=this.expression.charCodeAt(this.pos);if(n===43)this.tokenprio=0,this.tokenindex="+";else if(n===45)this.tokenprio=0,this.tokenindex="-";else if(n===124)if(this.expression.charCodeAt(this.pos+1)===124)this.pos++,this.tokenprio=0,this.tokenindex="||";else return!1;else if(n===42)this.tokenprio=1,this.tokenindex="*";else if(n===47)this.tokenprio=2,this.tokenindex="/";else if(n===37)this.tokenprio=2,this.tokenindex="%";else if(n===94)this.tokenprio=3,this.tokenindex="^";else return!1;return this.pos++,!0},isSign:function(){var n=this.expression.charCodeAt(this.pos-1);return n===45||n===43?!0:!1},isPositiveSign:function(){var n=this.expression.charCodeAt(this.pos-1);return n===43?!0:!1},isNegativeSign:function(){var n=this.expression.charCodeAt(this.pos-1);return n===45?!0:!1},isLeftParenth:function(){var n=this.expression.charCodeAt(this.pos);return n===40?(this.pos++,this.tmpprio+=10,!0):!1},isRightParenth:function(){var n=this.expression.charCodeAt(this.pos);return n===41?(this.pos++,this.tmpprio-=10,!0):!1},isComma:function(){var n=this.expression.charCodeAt(this.pos);return n===44?(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0):!1},isWhite:function(){var n=this.expression.charCodeAt(this.pos);return n===32||n===9||n===10||n===13?(this.pos++,!0):!1},isOp1:function(){for(var n,t="",i=this.pos;i<this.expression.length;i++){if(n=this.expression.charAt(i),n.toUpperCase()===n.toLowerCase()&&(i===this.pos||n!="_"&&(n<"0"||n>"9")))break;t+=n}return t.length>0&&t in this.ops1?(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0):!1},isOp2:function(){for(var n,t="",i=this.pos;i<this.expression.length;i++){if(n=this.expression.charAt(i),n.toUpperCase()===n.toLowerCase()&&(i===this.pos||n!="_"&&(n<"0"||n>"9")))break;t+=n}return t.length>0&&t in this.ops2?(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0):!1},isVar:function(){for(var n,t="",i=this.pos;i<this.expression.length;i++){if(n=this.expression.charAt(i),n.toUpperCase()===n.toLowerCase()&&(i===this.pos||n!="_"&&(n<"0"||n>"9")))break;t+=n}return t.length>0?(this.tokenindex=t,this.tokenprio=4,this.pos+=t.length,!0):!1},isComment:function(){var n=this.expression.charCodeAt(this.pos-1);return n===47&&this.expression.charCodeAt(this.pos)===42?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1}},n.Parser=r,r}(typeof exports=="undefined"?{}:exports);